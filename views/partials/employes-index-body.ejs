<div class="flex flex-col gap-6">
  <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
    <div>
      <h1 class="text-2xl font-semibold text-slate-900">Employés</h1>
      <p class="text-sm text-slate-600">Gestion des collaborateurs pouvant recevoir du matériel.</p>
    </div>
    <div class="flex items-center gap-3">
      <a
        href="/employes/ajouter"
        class="inline-flex items-center justify-center rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-700"
      >
        Nouvel employé
      </a>
      <a
        href="/export/employes"
        class="inline-flex items-center justify-center rounded-md border border-slate-300 px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 gap-2"
      >
        Export
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
        </svg>
      </a>
    </div>
  </div>

  <% if (successMessage) { %>
    <div class="rounded-md border border-emerald-300 bg-emerald-50 px-4 py-3 text-sm text-emerald-700">
      <%= successMessage %>
    </div>
  <% } %>
  <% if (errorMessage) { %>
    <div class="rounded-md border border-rose-300 bg-rose-50 px-4 py-3 text-sm text-rose-700">
      <%= errorMessage %>
    </div>
  <% } %>
  <% const totalEmployes = (territoires || []).reduce((sum, territoire) => {
    const group = (employesByTerritoire && employesByTerritoire[territoire]) || [];
    return sum + group.length;
  }, 0); %>

  <% if (totalEmployes === 0) { %>
    <div class="rounded-lg border border-dashed border-slate-300 bg-white p-8 text-center text-sm text-slate-600">
      Aucun employé enregistré pour le moment. Ajoutez votre premier collaborateur.
    </div>
  <% } %>

  <% (territoires || []).forEach((territoire) => { %>
    <% const group = (employesByTerritoire && employesByTerritoire[territoire]) || []; %>
    <% const territoireLabel = territoire === 'martinique' ? 'Martinique' : 'Guadeloupe'; %>
    <section class="space-y-4">
      <div class="flex items-center justify-between">
        <div>
          <h2 class="text-lg font-semibold text-slate-900">Territoire · <%= territoireLabel %></h2>
          <p class="text-sm text-slate-500">
            <%= group.length %> <%= group.length > 1 ? 'collaborateurs' : 'collaborateur' %> enregistré<%= group.length > 1 ? 's' : '' %>.
          </p>
        </div>
      </div>

      <% if (group.length === 0) { %>
        <div class="rounded-lg border border-dashed border-slate-300 bg-slate-50 p-6 text-center text-sm text-slate-500">
          Aucun collaborateur référencé pour <%= territoireLabel %>.
        </div>
      <% } else { %>
        <div class="overflow-x-auto rounded-lg border border-slate-200 bg-white shadow-sm">
          <table class="min-w-full divide-y divide-slate-200 text-sm">
            <thead class="bg-slate-50">
              <tr>
                <th class="px-4 py-3 text-left font-semibold text-slate-600">Nom</th>
                <th class="px-4 py-3 text-left font-semibold text-slate-600">Contact</th>
                <th class="px-4 py-3 text-left font-semibold text-slate-600">Poste</th>
                <th class="px-4 py-3 text-left font-semibold text-slate-600">Équipements</th>
                <th class="px-4 py-3 text-left font-semibold text-slate-600">Notes</th>
                <th class="px-4 py-3 text-right font-semibold text-slate-600">Actions</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-slate-100">
              <% group.forEach((employe) => { %>
                <tr
                  class="group cursor-pointer hover:bg-slate-50"
                  onclick="window.location.href='/employes/<%= employe.id %>'"
                >
                  <td class="px-4 py-3">
                    <div class="font-medium text-slate-900"><%= employe.nom_complet %></div>
                  </td>
                  <td class="px-4 py-3">
                    <% if (employe.email) { %>
                      <div><a href="mailto:<%= employe.email %>" class="text-indigo-600 hover:text-indigo-700" onclick="event.stopPropagation();"><%= employe.email %></a></div>
                    <% } %>
                    <% if (employe.telephone) { %>
                      <div class="text-sm text-slate-600"><%= employe.telephone %></div>
                    <% } %>
                  </td>
                  <td class="px-4 py-3 text-slate-700"><%= employe.poste || '—' %></td>
                  <td class="px-4 py-3">
                    <% if (employe.equipement_count > 0) { %>
                      <span class="inline-flex items-center rounded-full bg-indigo-50 px-3 py-1 text-xs font-semibold text-indigo-700">
                        <%= employe.equipement_count %> attribué(s)
                      </span>
                    <% } else { %>
                      <span class="text-slate-400">—</span>
                    <% } %>
                  </td>
                  <td class="px-4 py-3 text-slate-600"><%= employe.commentaire || '—' %></td>
                  <td class="px-4 py-3 text-right">
                    <div class="flex justify-end gap-2">
                      <a
                        href="/employes/modifier/<%= employe.id %>"
                        class="rounded-md border border-slate-300 px-3 py-1 text-xs font-medium text-slate-700 hover:bg-slate-50"
                        onclick="event.stopPropagation();"
                      >
                        Modifier
                      </a>
                      <a
                        href="/employes/supprimer/<%= employe.id %>"
                        class="rounded-md border border-rose-300 px-3 py-1 text-xs font-medium text-rose-600 hover:bg-rose-50"
                        onclick="event.stopPropagation(); return confirm('Supprimer cet employé ? Les équipements seront désattribués.');"
                      >
                        Supprimer
                      </a>
                    </div>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      <% } %>
    </section>
  <% }) %>
</div>
