<% const backHref = redirect === 'detail' && equipement && equipement.id ? `/equipements/${equipement.id}` : '/'; %>
<div class="max-w-3xl mx-auto flex flex-col gap-6">
  <div>
    <a href="<%= backHref %>" class="text-sm text-indigo-600 hover:text-indigo-700">← Retour</a>
  </div>
  <div class="rounded-lg border border-slate-200 bg-white p-6 shadow-sm">
    <h1 class="text-2xl font-semibold text-slate-900">
      <%= mode === 'edit' ? 'Modifier un équipement' : 'Ajouter un équipement' %>
    </h1>
    <p class="mt-2 text-sm text-slate-600">Les champs marqués d'un astérisque sont obligatoires.</p>

    <% if (errors.length) { %>
      <div class="mt-4 space-y-2 rounded-md border border-rose-300 bg-rose-50 px-4 py-3 text-sm text-rose-700">
        <% errors.forEach((error) => { %>
          <p><%= error %></p>
        <% }) %>
      </div>
    <% } %>

    <form
      class="mt-6 grid gap-4 md:grid-cols-2"
      method="post"
      action="<%= mode === 'edit' ? `/modifier/${equipement.id}` : '/ajouter' %>"
      enctype="multipart/form-data"
    >
      <% if (redirect === 'detail') { %>
        <input type="hidden" name="redirect" value="detail" />
      <% } %>
      <% if (equipement && equipement.employe_id && equipement.employe_id !== '') { %>
        <input type="hidden" name="came_from_employee" value="<%= equipement.employe_id %>" />
      <% } %>
      <% const identifiantsList = Array.isArray(equipement && equipement.identifiants)
        ? equipement.identifiants
        : (typeof identifiants !== 'undefined' && Array.isArray(identifiants) ? identifiants : []);
      %>
      <%- include('./equipements-form-fields', { equipement, states, employes, types, identifiants: identifiantsList }) %>

      <div class="md:col-span-2 flex justify-end gap-3 pt-2">
        <a
          href="<%= backHref %>"
          class="rounded-md border border-slate-300 px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50"
        >
          Annuler
        </a>
        <button
          type="submit"
          class="rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-700 <%= (types || []).length === 0 ? 'opacity-50 cursor-not-allowed hover:bg-indigo-600' : '' %>"
          <%= (types || []).length === 0 ? 'disabled aria-disabled="true"' : '' %>
        >
          <%= mode === 'edit' ? 'Mettre à jour' : 'Enregistrer' %>
        </button>
      </div>
    </form>
  </div>
</div>
